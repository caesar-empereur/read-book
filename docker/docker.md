## docker 背景





## docker 镜像，容器，仓库的关系

| 概念  | 解释  |
|:---------------|:-------------------|
|镜像 | 就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统 |
|容器 | 镜像和容器的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。 |
|仓库 | 仓库可看成一个代码控制中心，用来保存镜像 |

```
镜像类似 类，容器类似类创建的实例对象，仓库类似代码存放的地方
```

## docker 适合部署什么
- docker 容器技术针对的适合水平伸缩，能用于无状态计算的服务
- Docker 快速扩展的一个重要特征就是无状态，具有数据状态的都不适合直接放在 Docker 里面
- 有状态的服务对运行环境有高要求，例如 mysql IO访问，存储引擎对环境要求高，redis 需要内存容量大
- mysql 为啥不适合部署在 docker 中
    - 数据安全问题：容器随时可以停止、或者删除。当容器被rm掉，容器里的数据将会丢失
    
| 问题  | 原因  |
|:---------------|:-------------------|
|数据安全问题 | 容器随时可以停止、或者删除。当容器被rm掉，容器里的数据将会丢失 |
| | 为了避免数据丢失，用户可以使用数据卷挂载来存储数据。但是容器的 Volumes 设计是围绕 Union FS 镜像层提供持久存储，数据安全缺乏保证 |
|性能问题 | mysql IO访问，存储引擎对环境要求高 |
| | 数据库程序与数据分离, 数据库程序与数据需要进行分离，将数据存放到共享存储，程序放到容器里 |
| | 跑轻量级或分布式数据库 |
| 资源隔离| 如果其他应用过渡占用物理机资源，将会影响容器里 MySQL 的读写效率。 |

## docker 常见命令

| 指令  | 作用  |
|:---------------|:-------------------|
|docker search mysql | 搜索镜像 |
|docker pull mysql | 拉取镜像 |
|docker run -it ubuntu /bin/bash | 使用命令行运行容器 |
|docker images | 查看安装的镜像 |
|docker ps -a | 查看所有的运行的容器 |
|docker start 容器id | 启动容器 |
|docker stop  容器id | 停止容器 |
|docker rm 容器id | 删除容器 |
|docker logs 容器id | 查看一个容器输出的错误日志 |
|docker inspect 容器id | 查看一个容器的 网络配置,容器本身的ip是多少 |


## Dockerfile

```
FROM java:8
ADD vue-admin-server.jar app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

| 指令  | 作用  |
|:---------------|:-------------------|
|FROM | 定制的镜像都是基于 FROM 的镜像 |
|ADD | 把当前路径的文件添加到容器中 |
|EXPOSE | 暴露容器的指定端口 |
|ENTRYPOINT | 容器实际运行的命令 |
|docker build -t 镜像名称 . | 构建镜像 |
|docker images | 查看是否已经构建成功 |
|docker run -d -p 8080:8085 镜像名称 | 指定端口映射的方式来启动容器 |
|docker run --net=host 镜像名称 | 使用与宿主机一样的网络来启动容器 |


## docker 容器与宿主机的网络
- Docker提供几种网络类型，常见的有 bridge，host
    - bridge
    ```
    Bridge是Docker默认使用的网络类型。如图，网络中的所有容器可以通过IP互相访问。
    Bridge网络通过网络接口docker0 与主机桥接，容器中的网络与主机中的网络是隔离的
    可以在主机上通过ifconfig docker0查看到该网络接口的信息
    ```
    - host
    ```
    Host模式下，容器的网络接口不与宿主机网络隔离。容器与宿主机使用相同的网络，
    在容器中监听相应端口的应用能够直接被从宿主机访问。host网络仅支持Linux
    ```

## docker compose
