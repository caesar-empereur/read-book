## wms

## 入库
- 入库单的生成
  - 直接在页面新增，要根据实际有没有货物到达
  - 预约数据后，司机将货物送到仓库，仓库收货，质检完之后会生成入库单
  - 上位系统，例如SAP系统下发的入库单数据

- 收货
  - 收货是对入库单进行收货，收货之后做定位操作，会在库存纪录里面修改移入数量，并且 产生上架任务
  - 操作人做完上架任务后，才是把库存纪录的在库量修改

## 库存
- 库存关系
  - 订单中心跟仓储系统wms的库存之间的关系
  ```
  订单中心也就是承接tob, toc的订单系统, 业务系统是直接的下单的小程序，网页，app。
  这个系统会维护一个库存，wms 系统也会维护一个库存，他们直接的库存数量有相互影响的关系。
  但不是最直接的。wms 订单出库之后会会回推消息给订单中心，是消息异步通知的方式，不是强事务的。
  订单中心接受到消息之后会消费消息扣减对应的库存。订单中心的一开始的库存维护会根据运营人员
  查看wms系统的库存，然后设置一个初始值，后面wms系统的库存除了出库会影响之外，货品的过期
  质量问题，破损等也会重新调整，这时候需要订单中心的库存时不时的跟wms的库存做核对。这个叫库存
  盘点核对。
  ```
- 库存扣减
  ```
  首先库存表的信息有 仓库，货区，货架，货品，单位，在库量，移入量，已分配数量，已锁定数量，已冻结数量
  查询可以库存的时候用前面2个减去后面几个字段，修改库存也就是调整库存数量，
  需要对某一行的某个货品上库存锁(分布式锁)，重置几个字段的值
  ```

- 库存锁
```
库存锁的原因
库存纪录是先查出来，再更新数量，然后插入对应的库存流水纪录，不是简单的用一条sql语句
修改数量，因此先查出来后更新，再插入流水的过程，需要是完整的，为了防止并发修改库存数据。
因此加了 库存锁, redis 分布式锁
```
## 出库
- 订单合并
  ```
  订单合并的意思是将一起出库的多个出库单合并成一单，合并的标识是出库单中的收件人，或者手机号
  是一样的，说明这些出库单是出到同一个人那里，因此把相同的出库单的明细改成与头信息表关联，
  多出来的头信息表删除后复制到历史表里面
  ```
- 波次运行的流程
```
波次是指出库流程中的一系列组合操作，波次的作用，通过波次，将出库单需要的货品做对应的库存
扣减，
```
