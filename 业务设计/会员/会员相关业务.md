双11当天使用了50万张优惠券，前后一个星期使用了200万张优惠券

会员系统负责优惠券的发放，券的使用是订单系统

订单系统在下单的时候讲优惠券调用结算系统的接口，生成对应的券的结算信息(例如满减打折信息)
然后调用会员系统的优惠券核销接口，讲券设置为已经使用

- 优惠券的使用
    - 券的使用是订单，会员这边是券的核销接口
    - 订单在提交之后，包含有优惠券，积分，卡券之类的信息
    - 订单在提交支付之后，会在一个完整的事务里面调用，积分扣减，核销优惠券，第三方支付等
    - 如果优惠券核销异常，流程终止，返回个前端页面券当前不可用，是否继续支付
    - 客户放弃优惠券使用，前端会带上标记，支付的时候不会调用券的核销
- 优惠券核销后，第三方支付异常怎么处理
    - 第三方支付异常后，会发出消息，会员这边订阅该消息
    - 消息里面把券的状态改为未使用，积分未扣减
