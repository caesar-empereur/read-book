## 怎样才算分布式，微服务，微服务需要有什么元素
- 单体应用的多实例部署，负载均衡不算分布式系统，因为每个应用都不知道彼此的存在，没有通信
- 微服务包含的东西
  - 注册中心
  - 服务注册与发现
  - 配置中心
  - 服务调用(RPC的接口，协议的封装，编码解码)
  - 超时，熔断，降级，限流机制
  - 链路跟踪
  - 服务的网关与路由
  - 某些场景下的分布式锁与分布式事务

## 康威定律
- 任何组织在设计系统时，交付的设计方案在结构上应该保持与组织的沟通结构保持一致

## 跨服务的数据关联查询
- 单体应用拆分成微服务之后，怎么满足一些复杂的关联查询?
    - 把各个微服务的数据实时同步到一个集中的数仓
    - 在集中的数仓中关联查询，这个数仓可以是 es，或者是其他的

## springcloud 的 http 协议与 dubbo 的 rpc 协议有什么区别
- http 协议的传输内容一般都是 json，编码效率没有 rpc 协议高，传输格式涉及到编码解码，需要消耗CPU
- http 协议为了防止频繁建立TCP连接，会有 keepalive 机制，这个机制是占用着TCP连接的
- 如果短时间内有大量请求，请求处理后会有一段时间处于大量TCP连接占用的状态，消耗资源

## 应用为什么要拆分成微服务?
- 故障隔离
  - 为什么那么多老系统没人去重构，一直在运行，修改一个问题就要全部发布，一旦出问题，影响很严重
- 技术异构
  - 主体技术应该是相同的，不然团队之间开发人员很难交换
- 独立开发与部署
- 弹性优化与扩展

## 微服务拆分后的问题
- 服务划分过细，服务间关系复杂
- 服务数量太多，团队效率急剧下降
- 调用链太长，性能下降，问题定位困难
- 没有基础设施，服务治理,自动化支撑，无法快速交付
- 微服务可以共用数据库实例，但是不要公用数据库
- 个别服务没有做熔断设计，会导致整体出现雪崩效应
![2pc](https://github.com/caesar-empereur/read-book/blob/master/photo/distri/微服务基础设施.png)

## 微服务怎么拆分才算合理
- 按照业务流程或者功能拆分，可拆分分单独功能模块或者微服务模块
- 按照可靠性拆分-重要的，可靠性要求高的拆分出来
- 按照性能拆分-性能要求高的服务拆分出来
- 按照扩展性拆分-变化稳定的服务跟变化比较大的服务拆分开

## 微服务的降级与熔断
- 降级表示系统或者服务部分可用，熔断是直接完全的不可用，相当于把这部分功能直接断掉
- 降级的方式有限流，返回备用数据，调用fallback方法
