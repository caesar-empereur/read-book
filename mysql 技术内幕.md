## 1 章 mysql 技术体系

- 1 实例与数据库的区别
  * mysql 数据库是指操作系统文件的集合
  * mysql 实例是系统进程与内存区域的组成
  * 数据库实例才是处理数据的
  
- 2 innodb 存储引擎的特点

  * 支持事务
  * 行锁设计
  * 插入缓冲
  * 二次写
  * 自适应哈希索引
  
- innodb 存储引擎架构

![innodb](https://raw.githubusercontent.com/caesar-empereur/read-book/master/photo/mysql/innodb.png)


## 第 4 章 mysql 数据文件

  * 表都是根据主键顺序组织存放的，这种存储方式的表称为索引组织表
  * 页 是mysql 磁盘上最小单位的数据存储形式，也叫 块，每页的数据大小是 16 KB
  * 页存放的行记录也是有硬性定义的，最多允许存放16KB / 2-200行的记录，即7992行记录
  
## 第 5 章 mysql 索引

 * 树的数据结构
   * 平衡二叉树，红黑树等查找算法都是在内存中进行的，适合小文件，不适合磁盘查找的大文件
 * B 树分为 **[B-树](#B-树)**，**[B+树](#B+树)**，但都是 **[多路平衡查找](#多路平衡查找)** 的树结构
   * **[B-树](#B-树)** 的一个重要特点是 **[非叶子节点也会存储数据](#非叶子节点也会存储数据)**
   * **[B+树](#B+树)** 的一个重要特点是 **[只有叶子节点会存储数据](#只有叶子节点会存储数据)**，所有叶子节点通过链指针形成 **[排序链表](#排序链表)**
    
 * 聚集索引 与 辅助索引
  
  |索引类型 | 定义 |叶子节点存储的东西 | 定位方式 |
  |-----------|-------------------|------------|------|
  |聚集索引| 按照每张表的主键构造一棵B+树 | 行记录 | 通过搜寻聚集索引B树找到行记录 |
  |辅助索引| 按照每张表的主键外的字段构造一棵B+树| 聚集索引的键 | 通过非聚集索引B树找到 聚集索引的键，再通过聚集索引树找到行记录 |
 
 * 哈希索引
   * 哈希索引只有在等值查询才能发挥作用，范围查询是失效的
   
 ## mysql 隔离级别与脏读幻读
 
 * 事务的特性
 
      |特性|描述|
      |-----------|-------------------|
      |原子性|一个操作，要么成功，要么失败,没有中间状态|
      |一致性|从一个状态到另一个状态的一致性|
      |隔离性|事务与事务之间的操作不能互相影响|
      |持久性|事务一旦提交就应该永久保存|
      
  * 隔离级别与脏读幻读的关系
  
    |读的种类|种类描述|持久化类型|解决办法|办法描述
    |-----------|-------------------|-------------|-------------|-------------|
    |脏读{**[读未提交](#读未提交)**}|一个事务可以读取到另一个事务**未提交**的|数据|**[读提交](#读提交)**|一个事务必须等另一个事务提交后才能取|
    |不可重复读(虚读)|一个事务可以读取到另一个事务**提交**的|更新数据|**[重复读](#重复读)**|一个读的事务提交后，不允许更新操作|
    |幻读|一个事务可以读取到另一个事务**提交**的|插入数据|**[序列化](#序列化)**|最高级别，事务按照串行执行，安全性最高|
    
  * 死锁
  
      |定义|解决方案|
      |-----------|-------------------|
      |2个事务因争夺资源造成互相等待，没有外力作用无法推进下去|超时机制，超过等待时间就释放，另一个事务也能进行|
      
  * 死锁示例
  
      |时间|事务A|事务B|
      |-----------|-------------------|---------|
      |t1 |select * from table_a where a=1 for update|'|
      |t2 ||select * from table_a where a=2 for update|
      |t3 |select * from table_a where a=2 for update|'|
      |t4 |'|select * from table_a where a=1 for update|
      |t5 |'|error, deadlock|
      
## 第 7 章

* 事务的分类
|事务|描述|
|-----------|-------------------|
|扁平事务|事务由多个操作组成，一旦回滚必须回滚所有操作，代价很大|
|带有保存点的扁平事务|回滚时可以只回滚最新的保存点，但是系统奔溃，所有保存点都会消失|
|链式事务|提交事务操作和开始下一个事务操作将合并为一个原子操作|
|嵌套事务|父事务包含子事务，子事务的提交必须在父事务提交才能生效,一个子事务回滚，其他子事务也会回滚|
|分布式事务|事务的多个操作分布在多个服务器上|
