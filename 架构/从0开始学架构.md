## 基础架构13讲
### 软件结构设计的目的
- 架构设计的主要目的是为了解决软件系统复杂度带来的问题
- 通过熟悉和理解需求，识别系统复杂性所在的地方，然后针对这些复杂点进行架构设计

### 架构设计的原则
- 架构设计并不是要面面俱到，不需要每个架构都具备高性能、高可用、高扩展
- 而是要识别出复杂点然后有针对性地解决问题

### 复杂度来源
- 高性能
    - 高性能的一个解决方法是通过增加部署机器来实现集群
    - 集群的架构部署不是简单机器相加
    - 要实现集群的效果第一个是要分发请求任务
    - 第二是要请求任务分解，将软件系统中的功能模块划分单一职责，例如微服务拆分
- 高可用
    - 高性能增加机器的目的是扩展性能，高可用增加机器的目的是冗余服务资原
    - 高可用的一个概念就是单机出现问题，也不会影响服务的整体可用
    - 应用高可用
        - 指的是服务的业务逻辑，无论分发到哪个服务实例，处理结果应该是一样的
        - 任务分发机器还需要时刻检测业务服务器的状态，包括连接保持，心跳检测
        - 应用高可用有应用层部署用负载均衡nginx, 服务层用微服务的负载均衡
    - 存储高可用
        - 数据库一主多从的结构部署，实现数据有多个备份存储
        - 还有数据在多个机器存储中出现不一致，如何避免不一致导致的业务影响
    - 高性能与高可用在一些场景是互斥的，例如用缓存可以提高性能，但是可用的一致性方面下降了
- 可扩展性
    - 结构设计需要考虑扩展性，但不能任何点都考虑扩展性，不然设计无法落地
    - 实现扩展性的一个通用方法就是将不变的封装位稳定层，将变化的封装在变化层
    - 扩展性在实际体现中就是设计模式，例如模板模式，装饰模式
- 业务逻辑复杂
    - 调用链路比较长，任何一个环节出问题都可能影响可用性
    - 例如订单履约系统或者仓储系统，接受订单之后要根据sku拆分订单
    - 订单系统或者仓储系统是源头，可用性非常重要
    - 数据的实时性，一致性，实时性是否要求很高，写入之后需要马上读取的到，一致性要求高
- 应用的规模，大数据量的复杂性
    - 线性增长的数据，是否要区分开冷热数据，保证大数据量的条件下，服务还能保持稳定可用
    - 数据库的结构是否要分区表或者分库分表，可能要用中间件，复杂度增加了
### 结构设计的3大原则
- 合适原则-合适优于业界领先
- 简单原则-简单优于复杂
- 演化原则

### 高性能架构设计
- 数据库
    - 数据库的高性能设计的方式应该是演进的，缓存--读写分离--分库分表
    - 缓存能支持的就不用读写分离，读写分离适合读多写少的，例如博客微博
    - 读写分离解决的是读的并发量比较大，写的并发量比较大的时候就得用分库分表了
- nosql
    - K-V 存储：解决关系数据库无法存储数据结构的问题，以 Redis 为代表
    - 文档数据库：解决关系数据库强 schema 约束的问题，以 MongoDB 为代表
    - 列式数据库：解决关系数据库大数据场景下的 I/O 问题，以 HBase 为代表
    - 全文搜索引擎：解决关系数据库的全文搜索性能问题，以 Elasticsearch 为代表
### 扩展性架构设计
- 所有的可扩展性架构设计，背后的基本思想都是拆分
- 服务拆分可以有很多种方式
    - 按照业务流程或者功能拆分，可拆分分单独功能模块或者微服务模块
    - 按照可靠性拆分-重要的，可靠性要求高的拆分出来
    - 按照性能拆分-性能要求高的服务拆分出来
    - 按照扩展性拆分-变化稳定的服务跟变化比较大的服务拆分开
- 分层架构设计
    - 代理层
    - 应用层
    - 中间件层
    - 存储层
    - 缓存层
- 微服务的利弊
    - 微服务的优点
        - 实现了按照功能单一职责的设计原则
        - 单体应用服务话，单个服务扩容更加方便
    - 微服务的陷阱
        - 服务划分过细，服务间关系复杂
        - 服务数量太多，团队效率急剧下降
        - 调用链太长，性能下降
        - 调用链太长，问题定位困难
        - 没有基础设施，服务治理,自动化支撑，无法快速交付
        - 微服务可以共用数据库实例，但是不要公用数据库
        - 个别服务没有做熔断设计，会导致整体出现雪崩效应
        ![2pc](https://github.com/caesar-empereur/read-book/blob/master/photo/distri/微服务基础设施.png)
